<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>November 14, 2015</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>November 14, 2015</h1></header><div class="content"><div class="diary"><h2 id="node-js-v8">Node.js &amp; V8</h2>
<h3 id="-resident-set-size-https-en-wikipedia-org-wiki-resident_set_size-"><a href="https://en.wikipedia.org/wiki/Resident_set_size">Resident set size</a></h3>
<blockquote>
<p>In computing, resident set size (RSS) is the portion of memory occupied by a process that is held in main memory (RAM). The rest of the occupied memory exists in the swap space or file system, either because some parts of the occupied memory were paged out, or because some parts of the executable were never loaded</p>
</blockquote>
<h3 id="-http-apmblog-dynatrace-com-2015-11-04-understanding-garbage-collection-and-hunting-memory-leaks-in-node-js-http-apmblog-dynatrace-com-2015-11-04-understanding-garbage-collection-and-hunting-memory-leaks-in-node-js-"><a href="http://apmblog.dynatrace.com/2015/11/04/understanding-garbage-collection-and-hunting-memory-leaks-in-node-js/">http://apmblog.dynatrace.com/2015/11/04/understanding-garbage-collection-and-hunting-memory-leaks-in-node-js/</a></h3>
<p>Similar to JVM, the resident set is divided into:</p>
<ul>
<li>Code</li>
<li>Stack<ul>
<li>Primitives</li>
<li>Pointers referencing objects on the heap</li>
<li>Pointers defining control flow</li>
</ul>
</li>
<li>Heap<ul>
<li>Objects, strings, closures</li>
</ul>
</li>
</ul>
<p>This can be queried with <a href="https://nodejs.org/api/process.html#process_process_memoryusage"><code>process.memoryUsage()</code></a></p>
<ul>
<li>Looking at the <code>heap_used</code>, the saw-tooth pattern is created by Scavenge runs and the downward jumps indicate Mark-Sweep operations.</li>
<li><code>FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - process out of memory</code></li>
</ul>
<h4 id="-node-gc-profiler-https-github-com-bretcope-node-gc-profiler-"><a href="https://github.com/bretcope/node-gc-profiler">node-gc-profiler</a></h4>
<blockquote>
<p>A cross-platform (tested on Linux, Windows, and OSX) profiler for the v8 garbage collector running inside Node.js. It will emit an event after every GC cycle providing you information about the duration and type of cycle.</p>
</blockquote>
<pre><code>npm <span class="hljs-keyword">install</span> gc-profiler
</code></pre></div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/joyeecheung" class="author-name">Joyee Cheung</a>-<a href="https://github.com/joyeecheung/my-tech-diary" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>