<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>August 2, 2015</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/styles/global.css"><link rel="stylesheet" href="/diary/styles/tomorrow.css"><link rel="stylesheet" href="/diary/styles/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>August 2, 2015</h1></header><div class="content"><div class="diary"><h2 id="-document-domain-"><code>document.domain</code></h2>
<ul>
<li>Should have been read-only by <a href="http://www.w3.org/TR/DOM-Level-2-HTML/html.html#ID-2250147">W3C DOM Level 2</a>, but no one cares.</li>
<li>Why it can only be set to base domains? Because usually it&#39;s the base domains that got attacked by subdomains(e.g. attachments, comments), not the other way around.</li>
<li>And there is a gotcha: whenever you set <code>document.domain</code> to a value, the inner representation of the port will be null, so you need to set everyone&#39;s <code>document.domain</code> even if they are already on the base domain(because you need to make their port null too). See <a href="http://stackoverflow.com/questions/1481251/what-does-document-domain-document-domain-do">What does document.domain = document.domain do?</a></li>
</ul>
<h3 id="how-do-you-use-it-for-cross-domain-ajax">How do you use it for cross-domain AJAX</h3>
<p>Create a hidden iframe with <code>src=</code> the other origin. Set the <code>document.domain</code> of both to the base domain(for the iframe you need to let it load a script on its own to do it). After that they can communicate just like they are from the same domain, but the iframe can still talk to another domain, so you can use the iframe as a proxy, let it do the cross-domain request for you(use <code>iframe.contentWindow.XMLHttpRequest</code>), and get the results back from it.</p>
<p>In the script in your iframe:</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">document</span>.domain = <span class="hljs-string">'http://basedomain.com'</span>;
</code></pre>
<p>In the script in your outer page:</p>
<pre><code class="lang-javascript"><span class="hljs-built_in">document</span>.domain = <span class="hljs-string">'http://basedomain.com'</span>;
<span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> iframe.contentWindow.XMLHttpRequest();
<span class="hljs-comment">// then use it like it's your own XMLHttpRequest.</span>
</code></pre>
<h2 id="-browser-security-handbook-https-code-google-com-p-browsersec-wiki-main-"><a href="https://code.google.com/p/browsersec/wiki/Main">Browser Security Handbook</a></h2>
<p><a href="https://code.google.com/p/browsersec/wiki/Part2">Part 2</a> is very useful when crossing domains.</p>
</div></div><footer class="footer"><address class="author">Copyright &copy;<a rel="author" href="https://github.com/joyeecheung" class="author-name">Joyee Cheung</a>-<a href="https://github.com/joyeecheung/my-tech-diary" class="source-repo">Source</a></address><p>Generated by<a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>